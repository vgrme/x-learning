<link rel="import" href="form-course-image.html">
<link rel="import" href="../../components/iron-image/iron-image.html">

<dom-module id="part-course-image">
  <template>
    <style include="style-panel"></style>
    <style>
      .image {
        background-color: #eee;
        height: 100px;
        width: 20%;
      }
    </style>

    <api-s3-delete id="delete_document" on-delete-completed="on_delete_completed"></api-s3-delete>

    <div class="panel">
      <h3>Image</h3>
      <template is="dom-if" if="{{!course.cover}}">
        <form-course-image course="{{course}}" on-response="on_response" error="{{error}}"></form-course-image>
      </template>
      <template is="dom-if" if="{{course.cover}}">
        <iron-image class="image" preload src="{{course.cover}}" sizing="contain"></iron-image>
        <h4>Change course image:
          <form-course-image course="{{course}}" on-response="on_response" error="{{error}}"></form-course-image>
        </h4>
      </template>
    </div>

  </template>
</dom-module>
<script>
  Polymer({

    is: 'part-course-image',

    properties: {
      course: {
        type: Object,
        value: function () { return {}; }
      },
      image_name:{
        type: String
      }
    },

    attached:function(){
      this.image_name = this.course.cover.split('/').pop();
    },

    on_response: function(event){
      this.course.cover = event.detail.url;
      file_name = 'courses/' + this.course.id + '/' + this.image_name;
      this.$.delete_document.delete_file(file_name);
    },

    on_delete_completed : function(event){
      this.fire ('try-save');
    }

  });
</script>