<link rel="import" href="../../components/app-container/app-container.html">
<link rel="import" href="../app-theme/app-theme.html">
<link rel="import" href="../behavior-router/behavior-router.html">
<link rel="import" href="../page-404/page-404.html">
<link rel="import" href="../page-course/page-course.html">
<link rel="import" href="../page-courses/page-courses.html">
<link rel="import" href="../page-lecture/page-lecture.html">
<link rel="import" href="../page-lectures/page-lectures.html">
<link rel="import" href="../page-settings/page-settings.html">
<link rel="import" href="../page-home/page-home.html">
<link rel="import" href="../page-webinar/page-webinar.html">
<link rel="import" href="../page-webinar/part-webinar-video.html">

<dom-module id="app-boot">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <app-container id="app"></app-container>

  </template>
</dom-module>
<script>
  Polymer({

    is: 'app-boot',

    behaviors: [
      Polymer.BehaviorRouter
    ],

    '/admin': function (context) {
      context.page = 'page-home';
      this.open(context);
    },

    '/admin/home': function (context) {
      context.page = 'page-home';
      this.open(context);
    },

    '/admin/courses': function (context) {
        context.page = 'page-courses';
        this.open(context);
    },

    '/admin/courses/new': function (context) {
        context.page = 'page-course';
        context.data = { course:{} };
        this.open(context);
    },

    '/admin/courses/:course_id': function (context) {
        this.get_model({
          collection: 'courses',
          modelId: context.params.course_id,
          include: ['lectures','webinars']
        })
        .then(function (model) {
          context.page = 'page-course';
          context.data = {};
          context.data.course = model;
          this.open(context);
        }.bind(this))
        .catch(function (error) {
          this.redirect('/404');
        }.bind(this));
    },

    '/admin/courses/:course_id/lectures': function (context) {
      context.page = 'page-lectures';
      this.open(context);
    },

    '/admin/courses/:course_id/lectures/new': function (context) {
        this.get_model({
          collection: 'courses',
          modelId: context.params.course_id
        })
        .then(function (model) {
          context.page = 'page-lecture';
          context.data = { lecture: {},
          video:{} };
          context.data.course = model;
          this.open(context);
        }.bind(this))
        .catch(function (error) {
          this.redirect('/404');
        }.bind(this));
    },

    '/admin/courses/:course_id/lectures/:lecture_id': function (context) {
        this.get_model({
          collection: 'lectures',
          modelId: context.params.lecture_id,
          include:['course','video']
          })
        .then(function (model) {
          context.page = 'page-lecture';
          context.data = { lecture: model};
          context.data.course = model.course;
          context.data.video = model.video || {} ;
          this.open(context);
        }.bind(this))
        .catch(function (error) {
          this.redirect('/404');
        }.bind(this));
    },

    '/admin/courses/:course_id/webinar/new': function (context) {
        this.get_model({
          collection: 'courses',
          modelId: context.params.course_id
        })
        .then(function (model) {
          context.page = 'page-webinar';
          context.data = { webinar: {} };
          context.data.course = model;
          this.open(context);
        }.bind(this))
        .catch(function (error) {
          this.redirect('/404');
        }.bind(this));
    },

    '/admin/courses/:course_id/webinar/:webinar_id': function (context) {
        this.get_model({
          collection: 'webinars',
          modelId: context.params.webinar_id,
          include:['course']
          })
        .then(function (model) {
          context.page = 'page-webinar';
          context.data = { webinar: model};
          context.data.course = model.course;
          this.open(context);
        }.bind(this))
        .catch(function (error) {
          this.redirect('/404');
        }.bind(this));
    },

    '/admin/courses/:course_id/webinar/:webinar_id/start': function (context) {
        this.get_model({
          collection: 'webinars',
          modelId: context.params.webinar_id,
          include:['course']
          })
        .then(function (model) {
          context.page = 'part-webinar-video';
          context.data = { webinar: model};
          context.data.course = model.course;
          this.open(context);
        }.bind(this))
        .catch(function (error) {
          this.redirect('/404');
        }.bind(this));
    },

    '/admin/profile': function (context) {
      this.get_model({
          collection: 'members',
          modelId: this.session.get('user').id
        })
        .then(function (model) {
          context.page = 'page-settings';
          context.data = {};
          context.data.user = model;
          this.open(context);
        }.bind(this))
        .catch(function (error) {
          this.redirect('/404');
        }.bind(this));
    },


    '/admin/404': function (context) {
      context.page = 'page-404';
      this.open(context);
    }

  });
</script>
