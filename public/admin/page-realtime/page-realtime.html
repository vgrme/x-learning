<link rel="import" href="../../components/api-user/api-user.html">
<link rel="import" href="../../components/app-link/app-link.html">
<link rel="import" href="../../components/app-session/app-session.html">
<link rel="import" href="../layout-admin/layout-admin.html">
<link rel="import" href="../style-page/style-page.html">
<link rel="import" href="../style-panel/style-panel.html">
<link rel="import" href="form-realtime-lecture-actions.html">
<link rel="import" href="form-realtime-lecture-info.html">

<dom-module id="page-realtime">
  <template>

    <style include="style-page"></style>
    <style include="style-panel"></style>
    
    <app-session id="session"></app-session>


    <iron-ajax id="ajax_put" method="POST" handle-as="json" content-type="application/json" last-response="{{lecture}}" on-response="on_response_create"> </iron-ajax>

    <api-model-update id="update" collection="realtime_lectures" model-id="{{lecture.id}}"
      data="{{lecture}}" response="{{response}}" error="{{error}}">
    </api-model-update>

     <iron-ajax id="ajax_delete" method="DELETE"></iron-ajax>

    <layout-admin>
      <div class="container">
        <h1>Create realtime lecture {{lecture.title}}</h1>
        <div>
          <form-realtime-lecture-actions on-try-save="on_try_save" on-try-publish="on_try_publish"></form-realtime-lecture-actions>
        </div>
        <div class="panel">
          <h3>Info</h3>
          <form-realtime-lecture-info lecture="{{lecture}}" error="{{error}}"></form-realtime-lecture-info>
        </div>
      </div>
    </layout-admin>

  </template>
</dom-module>
<script>
  Polymer({

    is: 'page-realtime',

    properties: {
      lecture:{
        type:Object,
        value: function () { return {}; }
      }
    },

    on_try_save:function(event){
      console.log(this.lecture)
      event.stopPropagation();
      if(this.lecture.id){
        this.$.update.send();
      }
      else{
        this.$.ajax_put.body=JSON.stringify(this.lecture);
        this.$.ajax_put.url='/api/realtime_lectures';
        this.$.ajax_put.generateRequest();
      }
    },
    
    on_response_create:function(){
      page('/admin/realtime/' + this.lecture.id +'/publish',this.lecture)

    }
   

  });
</script>