<link rel="import" href="../../components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../components/layout-grid/layout-grid.html">
<link rel="import" href="part-course-lecture.html">
<link rel="import" href="../../styles/style-table/style-table.html">
<link rel="import" href="../../styles/style-basic/style-basic.html">

<dom-module id="part-lecture-others">
  <template>
    <style include="style-table"></style>
    <style include="style-basic"></style>

    <style>
   /*   .text-left{
        background-color: #fff;
      }*/
      .text{
        color:#fff;
      }
      .table-hover tbody tr:hover td, .table-hover tbody tr:hover th {
        background-color: #333;
      }
    </style>

    <api-model-find id="find" collection="courses" on-response="on_response" response="{{course}}"></api-model-find>

       <div class="table-responsive">
        <table class="table  table-hover">
          <thead>
            <tr>
            </tr>
          </thead>
          <tbody>
            <template id="lecture" is="dom-repeat" items="{{lectures}}" as="lecture">
              <tr class="text-left" on-click="on_click">
                <th scope="row" class="text">{{index}}.</th>
                <td class="text">{{lecture.title}}</td>
                <td class="text">{{lecture.video.duration}}</td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>

  </template>
</dom-module>

<script>
  Polymer({

    is: 'part-lecture-others',

    properties: {
      course: {
        type: Object,
        value: function () { return {}; }
      },
      lectures: {
        type: Array,
        value: function () { return []; }
      },
      now:{
        type: Object,
        value: function () { return {}; }
      }
    },

    attached:function(){
        this.$.find.include = [{'lectures': ['video']}];
        this.$.find.where = {id: this.course.id}
        this.$.find.send();
    },

    on_response:function(){
      this.course = this.course[0];
      this.lectures = this.course.lectures;
      this.lectures.forEach(function(lecture){
        if(lecture.video.duration){
            var time = moment(lecture.video.duration*1000)
            lecture.video.duration = time.minutes() + 'mm:' + time.seconds() +"ss";
          }
      })
    },

    on_click: function(event){
      page('/courses/'+ this.course.id + '/lectures/' + this.$.lecture.itemForElement(event.target).id);
    }

  });
</script>