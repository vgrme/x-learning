<link rel="import" href="part-course-webinar.html">
<link rel="import" href="../part-countdown/part-countdown.html">

<dom-module id="part-course-webinars">
  <template>
    <style include="style-table"></style>


    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
          </tr>
        </thead>
        <tbody>
          <template id="webinar" is="dom-repeat" items="{{webinars}}" as="webinar" filter="filter_state">
            <tr class="text-left" on-click="on_click">
            <th scope="row"> <i class="fa fa-video-camera"></i> Webinar {{index}}</th>
            <td>{{webinar.title}}</td>
            <td>{{webinar.message}}
            <template is="dom-if" if="{{webinar.countdown}}">
              <part-countdown date="{{webinar.data}}"></part-countdown></td>
            </template>  

            </tr>
          </template>               
          </td>

        </tbody>
      </table>
    </div>

  </template>
</dom-module>

<script>
  Polymer({

    is: 'part-course-webinars',

    properties: {
      course: {
        type: Object,
        value: function () { return {}; }
      },
      webinars: {
        type: Array,
        value: function () { return []; }
      },
      state: {
        type:Boolean,
        value: false
      }
    },

    on_click: function(event){
      if(this.$.webinar.itemForElement(event.target).state=="online" && this.auth)
        page('/courses/'+ this.course.id + '/webinar/' + this.$.webinar.itemForElement(event.target).id);
    },

    filter_state:function(webinar){
      var now = moment().format();
      var date = moment(webinar.data);

      if( webinar.state=='online'){
        console.log('1')
        webinar.message="Started";
      }

      if( webinar.state=='offline' ){
        webinar.message="Expired"
        webinar.countdown = false;          
      }

      if(webinar.state == 'false'){
          webinar.message="Starting in ";
          webinar.countdown = true;
      }

      return webinar;
        
    }

  });
</script>