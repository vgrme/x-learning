<link rel="import" href="../../components/app-link/app-link.html">
<link rel="import" href="../../components/api-model/api-model.html">
<link rel="import" href="../../components/iron-input/iron-input.html">
<link rel="import" href="../../styles/style-panel/style-panel.html">
<link rel="import" href="../layout-client/layout-client.html">
<link rel="import" href="part-home-categories.html">
<link rel="import" href="part-home-courses.html">
<link rel="import" href="part-home-find.html">
<link rel="import" href="part-home-webinar.html">

<dom-module id="page-home">
  <template>
    <style include="style-grid"></style>
    <style>
    :host{
      display: block;
    }
    .title {
      font-size: 13px;
      color: #333;
      font-family: font-bold;
      font-style: normal;
      font-weight: 300;
      text-transform: uppercase;
      letter-spacing: 0.75px;
      margin-bottom: 5px;
      margin-top: 26px;    
    }
    .sidebar{
      position: fixed;
    }
    .category{
      display: block;
      margin-top: 20px;
    }

    </style>

    <api-model-find id="ajax_find" collection="courses"
      on-response="on_response" include=["cover"] on-error="on_error">
    </api-model-find>

    <layout-client mode="waterfall-tall">
      <div class="container">
        <div class="row">
          <div class="col col-sm-2">
            <div class="sidebar">
              <h2 class="title">Categories</h2> 
              <part-home-categories class="category"></part-home-categories>
            </div>
          </div>
          <div class="col col-sm-10">
            <h2 class="title">Courses</h2>             
            <part-home-find on-try-find="on_try_find"></part-home-find>
            <part-home-courses courses="{{data.courses}}" on-select="on_select"></part-home-courses>
          </div>
        </div>
      </div>
    </layout-client>

  </template>
</dom-module>

<script>
  Polymer({

    is: 'page-home',

    properties: {
      courses:{
        type: Object,
        value: function() { return {}; }
      }
    },

    on_try_find:function(event){
      this.$.ajax_find.where = { and: [{"title" : {"like": event.detail ,"options":"i"}},{"publish": true}] };
      this.$.ajax_find.send();
    },

    on_response:function(event){
      this.courses=event.detail;
      page('/', event.detail);
    },

    on_select:function(event){
      page('/courses/' + event.detail.id)
    }

  });
</script>