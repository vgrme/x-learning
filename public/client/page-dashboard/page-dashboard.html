<link rel="import" href="../table-view/table-view.html">
<link rel="import" href="../../styles/style-navs/style-navs.html">
<link rel="import" href="../x-tabs/x-tabs.html">

<dom-module id="page-dashboard">
  <template>
    <style include="style-grid"></style>
    <style include="style-navs"></style>
    <style>
      .row{
            box-sizing: border-box;
      }

      .image {
        display:flex;
        height: 250px;
      }

      .info{
        @apply(--layout-vertical);
      }

      .item {
        display: flex;
      }
      .items .text{
        margin: 0px 30px;
      }
      .fa{
        width: 10px;
      }

      .title{
        margin: 0;
      }

      .edit {
        display: inline-flex;
      }
      .info .name{
        margin: 20px 0px;
      }

      .fa-pencil{
        display: inline-flex;
        margin-top: 15px;
      }
      .ul {
      /*@apply(--layout-justified)*/
      margin-top: 0;
      }
    </style>
    <layout-client>
      <div class="container">
        <div class="row">
          <div class="col col-md-3 info">
            <iron-image class="image" preload src="{{data.member.photo}}" sizing="cover"></iron-image> 
              <div class="edit">
                <h2 class="name">{{data.member.name}} {{data.member.last_name}}</h2>
                  <i class="fa fa-pencil" on-click="on_click_edit"></i>
                </span>
              </div>
              <div class="items">
                <div class="item">
                  <i class="fa fa-envelope-o"></i>
                  <h4 class="text">{{data.member.email}}</h4>
                </div>
                <div class="item">
                  <i class="fa fa-male"></i>
                  <h4 class="text">{{data.member.gender}}</h4>
                </div>
                <div class="item">
                  <i class="fa fa-phone"></i>
                  <h4 class="text">{{data.member.phone}}</h4>
                </div>
                <div class="item">
                  <i class="fa fa-map-o"></i>
                  <h4 class="text">{{data.member.location}}</h4>
                </div>
                <div class="item">
                  <i class="fa fa-calendar"></i>
                  <h4 class="text">{{member_data}}</h4>
                </div>
              </div>
          </div>
          <div class="col col-md-9 courses">

          <nav class="nav nav-tabs" on-click="on_click_nav">
            <ul class="ul">
              <li class="nav-item nav-link active" data-tab="lectures">Learning</li>
              <li class="nav-item nav-link active" data-tab="reviews">Reviews</li>
            </ul>
          </nav>

          <x-tabs id="tabs" current="{{current}}">
            <x-tab name="lectures">
              <h3 class="title">Learning</h3>
              <deck-courses courses="{{data.member.learning}}"></deck-courses>
            </x-tab>
            <x-tab name="reviews">
              <h3>Reviews</h3>
              <table-view items="{{reviews}}" fields='["course","title","text","rating"]' on-click="on_click">
              </table-view>
            </x-tab>
          </x-tabs>

            <div class="panel">
            </div>
          </div>
        </div>
      </div>
    </layout-client>

  </template>
</dom-module>

<script>
  Polymer({

    is: 'page-dashboard',

    properties: {
      data: {
        type: Object,
        value: function () { return {}; }
      },
      member_data:{
        type:String
      },
      reviews:{
        type: Object,
        value: function () { return []; }
      },
      current: {
        type: String,
        value: 'lectures'
      },
    },

    attached:function(){
      this.member_data = this.data.member.birthday.split('T')[0];

      this.reviews = this.data.member.reviews.map(function (review, index) {
        return {
          id: review.id,
          course: review.course.title,
          title: review.title,
          text: review.text,
          rating: String(review.rating/2),
          close: review.closed,
        index: '#' + index
        };
      })
    },

    on_click_edit: function(){
      page('/profile/setting')
    },

    on_click_nav: function (event) {
      var name = event.target.dataset.tab;
      this.set('current', name);
    },

    on_click:function(event){
      if(!event.detail.close)
        page('/review/' + event.detail.id);
    }

  });
</script>