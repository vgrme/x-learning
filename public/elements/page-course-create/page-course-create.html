<link rel="import" href="../../components/api-user/api-user.html">
<link rel="import" href="../part-jumbotron/part-jumbotron.html">
<link rel="import" href="../style-page/style-page.html">
<link rel="import" href="part-course-create.html">
<link rel="import" href="part-course-create-save.html">
<link rel="import" href="part-course-create-upload-image.html">


<dom-module id="page-course-create">
  <template>
    <style include="style-page"></style>
      <app-session id="session"></app-session>

      <iron-ajax id="ajax_put_member_teaching" method="POST" 
       content-type="application/json" on-error="on_error" on-response="on_response"
       last-response="{{course}}">
      </iron-ajax>    

      <layout-client>
        <part-jumbotron class="jumbotron">
          <h1>Create course</h1>
        </part-jumbotron>
        <div class="container">
          <part-course-create-save on-try-save="on_try_save"></part-course-create-save>
          
          <part-course-create course="{{course}}"></part-course-create>

          <part-course-create-upload-image on-response="on_upload"></part-course-create-upload-image>
        </div>
      </layout-client>
      
  </template>
</dom-module>

<script>
  Polymer({

    is: 'page-course-create',

    properties: {
      course: {
        type: Object,
        value: function () { return {}; }
      },
      members_join_courses:{
        type: Object,
        value:function(){ return {};}
      }
    },
    on_try_save:function(event){
      event.stopPropagation();
      this.course.date = Date();
      this.$.ajax_put_member_teaching.url = '/api/members/' + this.$.session.get('user').id + '/teaching';
      this.$.ajax_put_member_teaching.body = JSON.stringify(this.course);
      this.$.ajax_put_member_teaching.generateRequest();
    },

    on_response:function(event){
      console.log(this.course);
      // page('/courses/'+ this.course.id +'/lecture/new');
      page('/courses/'+ this.course.id +'/course_manage');
    },

    on_upload:function(event){
      var url = event.detail.split("?")[0];
      this.course.cover=url;
    }

  });
</script>